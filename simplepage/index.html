<!DOCTYPE html>
<html lang="zh-Hans">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="style.css" />
</head>
<body>
    <section class="navigation">
        <div class="profile">
            <img src="https://i.loli.net/2017/08/15/5992d89347d1e.png" alt="" class="avatar"/>
        </div>
        <div class="tags">
            <span>新闻动向</span>
            <span>时事趣事</span>
            <span>知识新知</span>
            <span>技术探讨</span>
        </div>
    </section>
    <section class="summary">
        <!--<h2 class="status-1">-->
            <!--<span>火影忍者十大尾兽能力排行</span>-->
        <!--</h2>-->
        <!--<h2 class="status-2">-->
            <!--<span>火影忍者十大尾兽能力排行</span>-->
            <!--<span>九尾九喇嘛排第二</span>-->
        <!--</h2>-->
        <!--<p><span>尾兽是作为非常特殊的存在，可以说从始至终，尾兽都是重要的贯穿剧情的线索。</span></p>-->
        <!--<p><span>那么在十大尾兽当中，谁的实力更强，谁又是查克拉量最多的呢？</span></p>-->
        <div class="slides">
            <ul class="slide">
                <li>
                    <a href="javascript:;">
                        <img src="https://i.loli.net/2017/08/15/5992b2d8514cb.png" alt="">
                    </a>
                </li>
                <li>
                    <a href="javascript:;">
                        <img src="https://i.loli.net/2017/08/15/5992b11669341.jpg" alt="">
                    </a>
                </li>
                <li>
                    <a href="javascript:;">
                        <img src="https://i.loli.net/2017/08/15/5992b12f2e41a.jpg" alt="">
                    </a>
                </li>
                <li>
                    <a href="javascript:;">
                        <img src="https://i.loli.net/2017/08/15/5992b14d973cd.jpg" alt="">
                    </a>
                </li>
            </ul>
            <span id="next">></span>
            <span id="prev"><</span>
            <ul class="menu">
                <li class="active">1</li>
                <li>2</li>
                <li>3</li>
                <li>4</li>
            </ul>
        </div>
    </section>
    <section class="album">
        <ul id="list">
            <li>
                <div class="oneToOne">
                    <img src="https://ooo.0o0.ooo/2017/05/16/591abc58c1661.png" alt="" />
                </div>
                <h3><span>一尾砂之守鹤</span></h3>
                <p>守鹤是一只形状如狸猫的巨大怪物...</p>
            </li>
            <li>
                <div class="oneToOne">
                    <img src="https://ooo.0o0.ooo/2017/05/15/5919b6b30e19d.jpg" alt="" />
                </div>
                <h3><span>二尾又旅</span></h3>
                <p>拥有巨大黑天使翅膀，原为死神的宠物...</p>
            </li>
            <li>
                <div class="oneToOne">
                    <img src="https://ooo.0o0.ooo/2017/05/16/591ab49857681.jpg" alt="" />
                </div>
                <h3><span>三尾矶抚</span></h3>
                <p>前额有勾状角突起的三尾鳍的鲨鱼怪物...</p>
            </li>
            <li>
                <div class="oneToOne">
                    <img src="https://ooo.0o0.ooo/2017/05/15/5919b70a4b52a.png" alt="" />
                </div>
                <h3><span>四尾孙悟空</span></h3>
                <p>六道仙人赐予的名字，自称齐天大圣...</p>
            </li>
            <li>
                <div class="oneToOne">
                    <img src="https://ooo.0o0.ooo/2017/05/15/5919b71cb2fd1.jpg" alt="" />
                </div>
                <h3><span>五尾穆王</span></h3>
                <p>五条尾巴可以放出五种元素的强力攻击...</p>
            </li>
            <li>
                <div class="oneToOne">
                    <img src="https://ooo.0o0.ooo/2017/05/15/5919b73072365.jpg" alt="" />
                </div>
                <h3><span>六尾犀犬</span></h3>
                <p>六条闪电状尾巴可以放出无限伏的电压...</p>
            </li>
            <li>
                <div class="oneToOne">
                    <img src="https://ooo.0o0.ooo/2017/05/15/5919b747e1221.jpg" alt="" />
                </div>
                <h3><span>七尾重明</span></h3>
                <p>九大神兽中最为狡猾，体型最小的尾兽...</p>
            </li>
            <li>
                <div class="oneToOne">
                    <img src="https://ooo.0o0.ooo/2017/05/15/5919b75a980b5.jpg" alt="" />
                </div>
                <h3><span>八尾牛鬼</span></h3>
                <p>八歧大蛇是八尾的原型、体形最大...</p>
            </li>
            <li>
                <div class="oneToOne">
                    <img src="https://ooo.0o0.ooo/2017/05/15/5919b76dc3273.jpg" alt="" />
                </div>
                <h3><span>九尾九喇嘛</span></h3>
                <p>最强的S级妖兽，为赤红色，其能力巨大.</p>
            </li>
        </ul>
    </section>
    <div class="loadMore">
        <button id="loadMoreButton">加载更多</button>
    </div>
    <script src="//apps.bdimg.com/libs/jquery/2.1.4/jquery.min.js"></script>
    <script>
        function go(index) {
            $('.menu > li').eq(index).addClass('active').siblings().removeClass('active');
            let width = $('.slide>li>a>img').width();
            $('.slide > li').css({
                transform: 'translateX(' + (-width * index) + 'px)'
            })
        }
        let current = 0;
        let player = false;
        function play(){
            if(player){
                current = $('.menu > li.active').index();
            }
            current = current + 1;
            if (current === 4) {
                current = 0
            }
            go(current);
        }
        let setIndex = setInterval(play, 3000);

        $('#next').on('click',function(){
            player =true;
            clearInterval(setIndex);
            let indexLi = $('.menu > li.active').index();
            indexLi++;
            if (indexLi === 4){
                indexLi = 0
            }
            go(indexLi);
        });
        $('#prev').on('click',function(){
            player = true;
            clearInterval(setIndex);
            let indexLi = $('.menu > li.active').index();
            indexLi--;
            if (indexLi === -1){
                indexLi = 3
            }
            go(indexLi);
        });
        $('.menu').on('click', 'li', function(e){
            player = true;
            clearInterval(setIndex);
            let $li = $(e.currentTarget);
            let index = $li.index();
            go(index);
        });
        $('.slides').on('mouseover',function(){
            clearInterval(setIndex);
        });
        $('.slides').on('mouseout',function(){
            setIndex = setInterval(play,3000);
        })


        // 预加载
        var loadingImage = new Image();
        loadingImage.src="https://i.loli.net/2017/08/08/5989307b6c87b.gif";
        let list = document.querySelector('#list');
        let loadMoreButton = document.querySelector('#loadMoreButton');
        let n =1;
        let demand = false;
        loadMoreButton.onclick = function(){
            if(demand){return}
            let request = new XMLHttpRequest();
            request.open('GET',`./page-${n+1}.html`);
            request.onerror = function(){
                demand = false
            };
            request.onload =function(){
                demand = false;
                n +=1;
                let response = request.responseText;
                let data = JSON.parse(response);
                for(var i=0;i < data.content.length;i++){
                    let liString = `
                            <li>
                                <div class="oneToOne">
                                    <img src="https://i.loli.net/2017/08/08/5989307b6c87b.gif" data-xxx="${data.content[i].url}">
                                </div>
                                <h3><span>${data.content[i].title}</span></h3>
                                <p>${data.content[i].text}</p>
                            </li>`;
                    list.insertAdjacentHTML('beforeend',liString)
                }
                if(data.hasNextPage === false){
                    loadMoreButton.disabled = true;
                    loadMoreButton.classList.add('active')
                }
            };
            demand = true;
            request.send()
        };
        window.onscroll = function(){
            var doc = document.documentElement;
            var top = (window.pageYOffset || doc.scrollTop)  - (doc.clientTop || 0);
            var clientHeight = doc.clientHeight;
            var viewportOffset = loadMoreButton.getBoundingClientRect();
            var buttonTop = viewportOffset.top;
            if( buttonTop <= clientHeight){
                loadMoreButton.click()
            }
            var images =document.querySelectorAll('img[data-xxx]');
            for (var i=0;i<images.length;i++){
                var imagesviewportOffset =images[i] .getBoundingClientRect();
                var imagesTop = imagesviewportOffset.top;
                if( imagesTop <= clientHeight){
                    images[i].src = images[i].getAttribute('data-xxx');
                    images[i].removeAttribute('data-xxx')
                }
            }
        }
    </script>
</body>
</html>